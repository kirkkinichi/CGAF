<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>
    </head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
        var createScene = function () {
        
            // This creates a basic Babylon Scene object (non-mesh)
            var scene = new BABYLON.Scene(engine);
            scene.enablePhysics();
            var camera = new BABYLON.ArcRotateCamera("Camera", BABYLON.Tools.ToRadians(-90), BABYLON.Tools.ToRadians(80), 300, new BABYLON.Vector3(0, -90, 0), scene);
            camera.attachControl(canvas, false);
        
            // This creates a light, aiming 0,1,0 - to the sky (non-mesh)
            var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);
            light.intensity = 0.7;
            
            var music = new BABYLON.Sound("Audio", "sounds/audio.mp3", scene, null, { loop: true, autoplay: true, volume:0.5 });           

            // Skybox
            var skybox = BABYLON.MeshBuilder.CreateBox("skyBox", {size:1000.0}, scene);
            var skyboxMaterial = new BABYLON.StandardMaterial("skyBox", scene);
            skyboxMaterial.backFaceCulling = false;
            skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("textures/skyboxBlack", scene);
            skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            skyboxMaterial.disableLighting = true;
            skybox.material = skyboxMaterial;
            //Materials
            var transparente = new BABYLON.StandardMaterial("transparente", scene);
	        transparente.alpha = 0.5;	
            var cianoMat = new BABYLON.StandardMaterial("cianoMat", scene);
	        cianoMat.diffuseColor = new BABYLON.Color3(0, 2, 1.3);
            var pinkMat = new BABYLON.StandardMaterial("pinkMat", scene);
	        pinkMat.diffuseColor = new BABYLON.Color3(2, 0, 1);
            var blueMat = new BABYLON.StandardMaterial("blueMat", scene);
	        blueMat.diffuseColor = new BABYLON.Color3(0, 0, 1);
            var blackMat = new BABYLON.StandardMaterial("blackMat", scene);
	        blackMat.diffuseColor = new BABYLON.Color3(0, 0, 0);

            //Glow
            var gl = new BABYLON.GlowLayer("glow", scene);
            gl.intensity = 0.8;
            gl.customEmissiveColorSelector = function(mesh, subMesh, material, result) {
                if (mesh.name === "sphere") {
                    result.set(2, 0, 1, 1);
                } 
                else if (mesh.name === "sphere2") {
                    result.set(0, 0, 1, 1);
                } 
                else if (mesh.name === "esferaCentro" || mesh.name === "esfera") {
                    result.set(0, 255, 161, 1);
                }   
                else if (mesh.name === "boxinclinado") {
                    result.set(0, 255, 161, 1);
                }   
                else {
                    result.set(0, 0, 0, 0);
                }
            }

            // Cylinder
            var cylinder = new BABYLON.StandardMaterial("cylinder", scene);
            cylinder.backFaceCulling = false;

            var path = [];            
            var segLength = 20;
            var numSides = 8;
            
            for(var i = 0; i < 2; i++) {
                var x = i * segLength;
                var y = 0;
                var z = 0;
                path.push(new BABYLON.Vector3(x, y, z));
                
            }  

            var tube = BABYLON.Mesh.CreateTube("tube", path, 4, numSides, null, 0, scene);
            tube.position = new BABYLON.Vector3(-4,-81.5,-16.5);
            tube.material = cylinder;
            tube.material = blackMat;

            //Esferas
            var sphere = BABYLON.Mesh.CreateSphere("sphere", 10, 2, scene);
            sphere.position = new BABYLON.Vector3(0,21,0);
            sphere.material = pinkMat;
            var sphere2 = BABYLON.Mesh.CreateSphere("sphere", 10, 2, scene);
            sphere2.position = new BABYLON.Vector3(7,-16,0);            
            sphere2.material = pinkMat;
            var sphere3 = BABYLON.Mesh.CreateSphere("sphere", 10, 2, scene);
            sphere3.position = new BABYLON.Vector3(-30,-28.4,0);
            sphere3.material = pinkMat;
            var esfera17 = BABYLON.Mesh.CreateSphere("sphere", 10, 2, scene);
            esfera17.position = new BABYLON.Vector3(-10,-51.25,-16.5);
            esfera17.material = pinkMat;
            var sphere4 = BABYLON.Mesh.CreateSphere("sphere2", 10, 2, scene);
            sphere4.position = new BABYLON.Vector3(14,-81.5,-16.5);
            sphere4.material = blueMat;           

            //Box Normais
            const box = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 11, depth: 1});
            box.position = new BABYLON.Vector3(-13,14.8,0);
            box.material = cianoMat;
            const box4 = BABYLON.MeshBuilder.CreateBox("box4", {height: 1, width: 50, depth: 10});
            box4.position = new BABYLON.Vector3(-15,-18,0);                        
            box4.material = new BABYLON.GridMaterial("chaoMat");  
            box4.material.backFaceCulling = false;              
            const box5 = BABYLON.MeshBuilder.CreateBox("box5", {height: 1, width: 8, depth: 1.8});
            box5.position = new BABYLON.Vector3(6,-17,2);                
            box5.material = transparente;  
            const box6 = BABYLON.MeshBuilder.CreateBox("box6", {height: 1, width: 8, depth: 1.8});
            box6.position = new BABYLON.Vector3(6,-17,-2);  
            box6.material = transparente;  
            const box8 = BABYLON.MeshBuilder.CreateBox("box8", {height: 1, width: 40, depth: 1.8});
            box8.position = new BABYLON.Vector3(-12,-30,0);
            box8.material = new BABYLON.GridMaterial("chaoMat");  
            box8.material.backFaceCulling = false;                 
            const box9 = BABYLON.MeshBuilder.CreateBox("box9", {height: 14, width: 14, depth: 1});
            box9.position = new BABYLON.Vector3(-31,-38.5,-18); 
            box9.material = transparente;
            const box13 = BABYLON.MeshBuilder.CreateBox("box13", {height: 1, width: 40, depth: 4});
            box13.position = new BABYLON.Vector3(-12,-45,-16.5);                   
            box13.material = new BABYLON.GridMaterial("chaoMat");  
            box13.material.backFaceCulling = false;                    
            const box14 = BABYLON.MeshBuilder.CreateBox("box14", {height: 6, width: 14, depth: 1});
            box14.position = new BABYLON.Vector3(-31,-42.5,-15.2);  
            box14.material = transparente; 
            const box18 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 15, depth: 1});
            box18.position = new BABYLON.Vector3(-3,-53,-16.5);   
            box18.material = cianoMat;            
            const box19 = BABYLON.MeshBuilder.CreateBox("boxparede", {height: 2, width: 15, depth: 0.5});
            box19.position = new BABYLON.Vector3(-3,-53,-15.5);            
            box19.material = transparente;   
            const box20 = BABYLON.MeshBuilder.CreateBox("boxparede", {height: 2, width: 15, depth: 0.5});
            box20.position = new BABYLON.Vector3(-3,-53,-17.5);
            box20.material = transparente;     
            const box22 = BABYLON.MeshBuilder.CreateBox("box22", {height: 1, width: 40, depth: 4});
            box22.position = new BABYLON.Vector3(0,-83,-16.5);          
            box22.material = new BABYLON.GridMaterial("chaoMat");  
            box22.material.backFaceCulling = false;
            const box24 = BABYLON.MeshBuilder.CreateBox("box24", {height: 1, width: 40, depth: 4});
            box24.position = new BABYLON.Vector3(50,-100,-16.5);          
            box24.material = new BABYLON.GridMaterial("chaoMat");  
            box24.material.backFaceCulling = false;
            const box25 = BABYLON.MeshBuilder.CreateBox("box25", {height: 4, width: 1, depth: 4});
            box25.position = new BABYLON.Vector3(69.5,-98,-16.5);          
            box25.material = new BABYLON.GridMaterial("chaoMat");  
            box25.material.backFaceCulling = false;
            const box26 = BABYLON.MeshBuilder.CreateBox("box26", {height: 1, width: 60, depth: 4});
            box26.position = new BABYLON.Vector3(0,-112,-16.5);          
            box26.material = new BABYLON.GridMaterial("chaoMat");  
            box26.material.backFaceCulling = false;
            

            //Box Inclinados
            const box2 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 14, depth: 1});
            box2.position = new BABYLON.Vector3(-1.7,18,0);
            box2.rotation.z = 0.5;
            box2.material = cianoMat;
            const box3 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 14, depth: 1});
            box3.position = new BABYLON.Vector3(-28,-14,0);
            box3.rotation.z = -0.5;
            box3.material = cianoMat;
            const box7 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 14, depth: 1});
            box7.position = new BABYLON.Vector3(10,-25,0);
            box7.rotation.z = 0.8;
            box7.material = cianoMat;
            const box10 = BABYLON.MeshBuilder.CreateBox("box10", {height: 1, width: 5, depth: 14});
            box10.position = new BABYLON.Vector3(-33,-32,-5.8);
            box10.rotation.x = 6;                              
            box10.material = new BABYLON.GridMaterial("chaoMat");  
            box10.material.backFaceCulling = false;              
            const box11 = BABYLON.MeshBuilder.CreateBox("boxparede", {height: 4, width: 1, depth: 15});
            box11.position = new BABYLON.Vector3(-36,-30.5,-5.8);
            box11.rotation.x = 6;  
            box11.material = transparente;         
            const box12 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 13, depth: 3});
            box12.position = new BABYLON.Vector3(-33,-38,-17);            
            box12.rotation.z = -0.8; 
            box12.material = cianoMat;           
            const box15 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 13, depth: 1});
            box15.position = new BABYLON.Vector3(10,-48,-16.5);            
            box15.rotation.z = 0.8;
            box15.material = cianoMat;
            const box16 = BABYLON.MeshBuilder.CreateBox("boxparede", {height: 2, width: 13, depth: 0.5});
            box16.position = new BABYLON.Vector3(10,-48,-17.5);            
            box16.rotation.z = 0.8;
            box16.material = transparente;
            const box17 = BABYLON.MeshBuilder.CreateBox("boxparede", {height: 2, width: 13, depth: 0.5});
            box17.position = new BABYLON.Vector3(10,-48,-15.5);            
            box17.rotation.z = 0.8;
            box17.material = transparente;
            const box21 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 14, depth: 1});
            box21.position = new BABYLON.Vector3(-13,-78,-16.5);
            box21.rotation.z = -0.8;
            box21.material = cianoMat;
            const box23 = BABYLON.MeshBuilder.CreateBox("boxinclinado", {height: 1, width: 14, depth: 1});
            box23.position = new BABYLON.Vector3(25,-89.5,-16.5);
            box23.rotation.z = -0.8;
            box23.material = cianoMat;
            


            //Dominó
            const domino = BABYLON.MeshBuilder.CreateBox("domino", {height: 3, width: 0.35, depth: 2});
            domino.position = new BABYLON.Vector3(-15,-16,0);
            const domino2 = BABYLON.MeshBuilder.CreateBox("domino2", {height: 3, width: 0.35, depth: 2});
            domino2.position = new BABYLON.Vector3(-12,-16,0);
            const domino3 = BABYLON.MeshBuilder.CreateBox("domino3", {height: 3, width: 0.35, depth: 2});
            domino3.position = new BABYLON.Vector3(-9,-16,0);
            const domino4 = BABYLON.MeshBuilder.CreateBox("domino4", {height: 3, width: 0.35, depth: 2});
            domino4.position = new BABYLON.Vector3(-6,-16,0);
            const domino5 = BABYLON.MeshBuilder.CreateBox("domino5", {height: 3, width: 0.35, depth: 2});
            domino5.position = new BABYLON.Vector3(-3,-16,0);
            const domino6 = BABYLON.MeshBuilder.CreateBox("domino6", {height: 3, width: 0.35, depth: 2});
            domino6.position = new BABYLON.Vector3(-0,-16,0);
            const domino7 = BABYLON.MeshBuilder.CreateBox("domino7", {height: 3, width: 0.35, depth: 2});
            domino7.position = new BABYLON.Vector3(3,-16,0);

            // OBSTÁCULOS

            var mat = new BABYLON.StandardMaterial("mat", scene);
            var texture = new BABYLON.Texture("textures/cubo.jpeg", scene);
            mat.diffuseTexture = texture;

            var faceUV = new Array(6);

            //set all faces
            faceUV[0] = new BABYLON.Vector4(0, 0.5, 1 / 3, 1);
            faceUV[1] = new BABYLON.Vector4(1 / 3, 0, 2 / 3, 0.5);
            faceUV[2] = new BABYLON.Vector4(2 / 3, 0, 1, 0.5);
            faceUV[3] = new BABYLON.Vector4(0, 0, 1 / 3, 0.5);
            faceUV[4] = new BABYLON.Vector4(1 / 3, 0.5, 2 / 3, 1);
            faceUV[5] = new BABYLON.Vector4(2 /3, 0.5, 1, 1);

            //wrap set
            var options = {
                faceUV: faceUV,
                wrap: true,
                height: 4,
                width: 4,
                depth: 4
            };
            
            var head = BABYLON.MeshBuilder.CreateBox("head", options, scene);            
            head.position = new BABYLON.Vector3(-13,-100,0);
            head.material = mat;

            const obstaculo = BABYLON.MeshBuilder.CreateBox("obstaculo", {height: 4, width: 4, depth: 4});
            obstaculo.material = new BABYLON.GridMaterial("chaoMat");  
            obstaculo.material.backFaceCulling = false;



            let barrel = BABYLON.MeshBuilder.CreateCylinder("barrel", {height: 3, diameter: 2, tessellation: 96}, scene);
            barrel.position = new BABYLON.Vector3(-29.5, -110, -16.5);
    

            BABYLON.SceneLoader.ImportMesh(
                "",
                "https://models.babylonjs.com/",
                "ExplodingBarrel.glb",
                scene,
                function (meshes) {          
                    const root = meshes.find(function (mesh) {return mesh.name === "__root__"});
                    root.parent = barrel;
                    root.scaling = new BABYLON.Vector3(0.05, 0.05, 0.05);
                    root.position = new BABYLON.Vector3(0, -1.5, 0);

                    root.physicsImpostor = new BABYLON.PhysicsImpostor(root, BABYLON.PhysicsImpostor.CylinderImpostor, { mass: 1, restitution: 0.1 }, scene);
                    barrel.physicsImpostor = new BABYLON.PhysicsImpostor(barrel, BABYLON.PhysicsImpostor.CylinderImpostor, { mass: 1, restitution: 0.1 }, scene);
                }
            );

            // GEAR
            const gear = BABYLON.MeshBuilder.CreateBox("gear", {height: 16, width: 1, depth: 3});
            gear.material = cianoMat;
            const gear2 = BABYLON.MeshBuilder.CreateBox("gear", {height: 1, width: 16, depth: 3});
            gear2.material = cianoMat;
            const gear3 = BABYLON.MeshBuilder.CreateBox("gear", {height: 16, width: 1, depth: 3});
            gear3.material = cianoMat;
            const gear4 = BABYLON.MeshBuilder.CreateBox("gear", {height: 1, width: 16, depth: 3});
            gear4.material = cianoMat;

            //Torus
            var torus = BABYLON.Mesh.CreateTorus("torus", 10, 2, 30, scene, false);
            torus.position = new BABYLON.Vector3(-32, 0,0);
            torus.material = cianoMat;
            var torus2 = BABYLON.Mesh.CreateTorus("torus", 8, 2, 30, scene, false);
            torus2.position = new BABYLON.Vector3(-32, -2,0);
            torus2.material = cianoMat;
            var torus3 = BABYLON.Mesh.CreateTorus("torus", 6, 2, 30, scene, false);
            torus3.position = new BABYLON.Vector3(-32, -4,0);
            torus3.material = cianoMat;
            var torus4 = BABYLON.Mesh.CreateTorus("torus", 4.4, 2, 30, scene, false);
            torus4.position = new BABYLON.Vector3(-32, -6,0);
            torus4.material = cianoMat;

            
            //INICIO ESFERAS
            var esferaCentro = BABYLON.Mesh.CreateSphere("esferaCentro", 0, 0, scene);
        	esferaCentro.position = new BABYLON.Vector3(0, 0, 0);    
            esferaCentro.visibility = 0;            
            var esfera = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera.parent = esferaCentro;            
            esfera.material = cianoMat;
            var esfera2 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera2.parent = esferaCentro;          
            esfera2.material = cianoMat;
            var esfera3 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera3.parent = esferaCentro;          
            esfera3.material = cianoMat;
            var esfera4 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera4.parent = esferaCentro;          
            esfera4.material = cianoMat;
            var esfera5 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera5.parent = esferaCentro;          
            esfera5.material = cianoMat;
            var esfera6 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera6.parent = esferaCentro;          
            esfera6.material = cianoMat;
            var esfera7 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera7.parent = esferaCentro;          
            esfera7.material = cianoMat;
            var esfera8 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera8.parent = esferaCentro;          
            esfera8.material = cianoMat;
            var esfera9 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera9.parent = esferaCentro;          
            esfera9.material = cianoMat;
            var esfera10 = BABYLON.Mesh.CreateSphere("esfera", 16, 1, scene);
        	esfera10.parent = esferaCentro;          
            esfera10.material = cianoMat;
            
            var esfera11 = BABYLON.Mesh.CreateSphere("esfera11", 10, 2, scene);
            esfera11.position = new BABYLON.Vector3(-8,-51.25,-16.5);
            esfera11.material = blueMat;
            var esfera12 = BABYLON.Mesh.CreateSphere("esfera12", 10, 2, scene);
            esfera12.position = new BABYLON.Vector3(-6,-51.25,-16.5);
            esfera12.material = blueMat;
            var esfera13 = BABYLON.Mesh.CreateSphere("esfera13", 10, 2, scene);
            esfera13.position = new BABYLON.Vector3(-4,-51.25,-16.5);
            esfera13.material = blueMat;
            var esfera14 = BABYLON.Mesh.CreateSphere("esfera14", 10, 2, scene);
            esfera14.position = new BABYLON.Vector3(-2,-51.25,-16.5);
            esfera14.material = blueMat;
            var esfera15 = BABYLON.Mesh.CreateSphere("esfera15", 10, 2, scene);
            esfera15.position = new BABYLON.Vector3(0,-51.25,-16.5);
            esfera15.material = blueMat;
            var esfera16 = BABYLON.Mesh.CreateSphere("esfera16", 10, 2, scene);
            esfera16.position = new BABYLON.Vector3(2,-51.25,-16.5);
            esfera16.material = blueMat;
            
            //FIM ESFERAS

        	
            //Kill Box
            var killBox = BABYLON.MeshBuilder.CreateBox("killBox", {width:500, depth:500, height:0.5}, scene);
            killBox.position = new BABYLON.Vector3(0,-100,0);
            killBox.visibility = 0;	

            //INICIO LINHAS
            var myPoints2 = [];
            var theta = 0;

            for (var i = 0; i<360; i++) {           
                myPoints2.push(new BABYLON.Vector3(0, 6 * Math.sin(theta), 6 * Math.cos(theta)));
                theta += 0.1;
            }           
            
            
            var linesVertical = BABYLON.MeshBuilder.CreateLines("linesVertical", {points: myPoints2, updatable: true}, scene);
            linesVertical.position = new BABYLON.Vector3(0, -30, 0);
            linesVertical.isPickable = false; 
            var linesVertical2 = BABYLON.MeshBuilder.CreateLines("linesVertical2", {points: myPoints2, updatable: true}, scene);
            linesVertical2.position = new BABYLON.Vector3(-6, -30, 0);
            linesVertical2.isPickable = false; 
            var linesVertical3 = BABYLON.MeshBuilder.CreateLines("linesVertical3", {points: myPoints2, updatable: true}, scene);
            linesVertical3.position = new BABYLON.Vector3(-12, -30, 0);
            linesVertical3.isPickable = false; 
            var linesVertical4 = BABYLON.MeshBuilder.CreateLines("linesVertical4", {points: myPoints2, updatable: true}, scene);
            linesVertical4.position = new BABYLON.Vector3(-18, -30, 0);
            linesVertical4.isPickable = false;            
            var linesVertical5 = BABYLON.MeshBuilder.CreateLines("linesVertical5", {points: myPoints2, updatable: true}, scene);
            linesVertical5.position = new BABYLON.Vector3(-24, -30, 0);
            linesVertical5.isPickable = false; 
            //FIM LINHAS   
        	
    
            // INICIO PARTICULAS
            var particleSystem = new BABYLON.ParticleSystem("particles", 2000, scene);

            particleSystem.particleTexture = new BABYLON.Texture("/textures/flare.png", scene);

            // Origem Partículas
            particleSystem.emitter = torus; // the starting object, the emitter
            particleSystem.minEmitBox = new BABYLON.Vector3(-1, 0, 0); // Starting all from
            particleSystem.maxEmitBox = new BABYLON.Vector3(1, 0, 0); // To...

            // Cor das Partículas
            particleSystem.color1 = new BABYLON.Color4(0.7, 0.8, 1.0, 1.0);
            particleSystem.color2 = new BABYLON.Color4(0.2, 0.5, 1.0, 1.0);
            particleSystem.colorDead = new BABYLON.Color4(0, 0, 0.2, 0.0);

            particleSystem.minSize = 0.1;
            particleSystem.maxSize = 0.5;

            // Tempo de vida Partículas
            particleSystem.minLifeTime = 0.3;
            particleSystem.maxLifeTime = 1.5;

            particleSystem.emitRate = 1500;

            particleSystem.blendMode = BABYLON.ParticleSystem.BLENDMODE_ONEONE;

            particleSystem.gravity = new BABYLON.Vector3(0, -9.81, 0);

            // Direção Partículas
            particleSystem.direction1 = new BABYLON.Vector3(5, 10, 5);
            particleSystem.direction2 = new BABYLON.Vector3(-5, 0, -5);
            
            particleSystem.minAngularSpeed = 0;
            particleSystem.maxAngularSpeed = Math.PI;

            // Velocidade Partículas
            particleSystem.minEmitPower = 1;
            particleSystem.maxEmitPower = 3;
            particleSystem.updateSpeed = 0.005;

            particleSystem.isLocal = true;

            particleSystem.start();
            //FIM PARTÍCULAS
            
            // GUI
            var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
            var instructions = new BABYLON.GUI.TextBlock();
            instructions.text = "Nome: Kirk Kinichi Tomisaki Rodrigues da Silva - RA: 171277";
            instructions.color = "white";
            instructions.fontSize = 16;
            instructions.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT
            instructions.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM
            advancedTexture.addControl(instructions);       

            // Animacao
            var alpha = 0; var beta = 0; var charlie = 0; var delta = 0;
            scene.beforeRender = function () {

                esfera.position = new BABYLON.Vector3(esfera.parent.position.x-24, 6 * Math.sin(alpha)-30, 6 * Math.cos(alpha));   
                esfera2.position = new BABYLON.Vector3(esfera2.parent.position.x-24, -6 * Math.sin(alpha)-30, -6 * Math.cos(alpha));     
                esfera3.position = new BABYLON.Vector3(esfera3.parent.position.x-18, 6 * Math.sin(alpha)-30, 6 * Math.cos(alpha));   
                esfera4.position = new BABYLON.Vector3(esfera4.parent.position.x-18, -6 * Math.sin(alpha)-30, -6 * Math.cos(alpha));                
                esfera5.position = new BABYLON.Vector3(esfera5.parent.position.x-12, 6 * Math.sin(alpha)-30, 6 * Math.cos(alpha));   
                esfera6.position = new BABYLON.Vector3(esfera6.parent.position.x-12, -6 * Math.sin(alpha)-30, -6 * Math.cos(alpha));                
                esfera7.position = new BABYLON.Vector3(esfera7.parent.position.x-6, 6 * Math.sin(alpha)-30, 6 * Math.cos(alpha));   
                esfera8.position = new BABYLON.Vector3(esfera8.parent.position.x-6, -6 * Math.sin(alpha)-30, -6 * Math.cos(alpha));                
                esfera9.position = new BABYLON.Vector3(esfera9.parent.position.x, 6 * Math.sin(alpha)-30, 6 * Math.cos(alpha));   
                esfera10.position = new BABYLON.Vector3(esfera10.parent.position.x, -6 * Math.sin(alpha)-30, -6 * Math.cos(alpha));     
                head.position = new BABYLON.Vector3(-10,-3 * Math.sin(beta)-39.5,-16.5);
                obstaculo.position = new BABYLON.Vector3(-10 * Math.sin(beta)+56.5,-98,-16.5)
                gear.position = new BABYLON.Vector3(-24,-65,-16.5);
                gear.rotation.z = charlie;
                gear2.position = new BABYLON.Vector3(-24,-65,-16.5);
                gear2.rotation.z = charlie;
                gear3.position = new BABYLON.Vector3(-4.5,-65,-16.5);
                gear3.rotation.z = delta;
                gear4.position = new BABYLON.Vector3(-4.5,-65,-16.5);
                gear4.rotation.z = delta;
        		alpha += 0.05; beta += 0.010; charlie += 0.007; delta -= 0.007;
            };
            

            sphere.physicsImpostor = new BABYLON.PhysicsImpostor(sphere, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0 }, scene);
        	sphere2.physicsImpostor = new BABYLON.PhysicsImpostor(sphere2, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0 }, scene);
        	sphere3.physicsImpostor = new BABYLON.PhysicsImpostor(sphere3, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0 }, scene);
        	sphere4.physicsImpostor = new BABYLON.PhysicsImpostor(sphere4, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.4 }, scene);
            box.physicsImpostor = new BABYLON.PhysicsImpostor(box, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box2.physicsImpostor = new BABYLON.PhysicsImpostor(box2, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);            
        	box3.physicsImpostor = new BABYLON.PhysicsImpostor(box3, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);           
        	box4.physicsImpostor = new BABYLON.PhysicsImpostor(box4, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);          
        	box5.physicsImpostor = new BABYLON.PhysicsImpostor(box5, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);          
        	box6.physicsImpostor = new BABYLON.PhysicsImpostor(box6, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);      
        	box7.physicsImpostor = new BABYLON.PhysicsImpostor(box7, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box8.physicsImpostor = new BABYLON.PhysicsImpostor(box8, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box9.physicsImpostor = new BABYLON.PhysicsImpostor(box9, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box10.physicsImpostor = new BABYLON.PhysicsImpostor(box10, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box11.physicsImpostor = new BABYLON.PhysicsImpostor(box11, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box12.physicsImpostor = new BABYLON.PhysicsImpostor(box12, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	box13.physicsImpostor = new BABYLON.PhysicsImpostor(box13, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);
        	box14.physicsImpostor = new BABYLON.PhysicsImpostor(box14, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	box15.physicsImpostor = new BABYLON.PhysicsImpostor(box15, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);  
        	box16.physicsImpostor = new BABYLON.PhysicsImpostor(box16, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);    
        	box17.physicsImpostor = new BABYLON.PhysicsImpostor(box17, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);    
        	box18.physicsImpostor = new BABYLON.PhysicsImpostor(box18, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);    
        	box19.physicsImpostor = new BABYLON.PhysicsImpostor(box19, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);    
        	box20.physicsImpostor = new BABYLON.PhysicsImpostor(box20, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);    
        	box21.physicsImpostor = new BABYLON.PhysicsImpostor(box21, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene);    
        	box22.physicsImpostor = new BABYLON.PhysicsImpostor(box22, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	box23.physicsImpostor = new BABYLON.PhysicsImpostor(box23, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	box24.physicsImpostor = new BABYLON.PhysicsImpostor(box24, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	box25.physicsImpostor = new BABYLON.PhysicsImpostor(box25, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	box26.physicsImpostor = new BABYLON.PhysicsImpostor(box26, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.9 }, scene); 
        	torus.physicsImpostor = new BABYLON.PhysicsImpostor(torus, BABYLON.PhysicsImpostor.MeshImpostor, { mass: 0, restitution: 0 }, scene);            
        	torus2.physicsImpostor = new BABYLON.PhysicsImpostor(torus2, BABYLON.PhysicsImpostor.MeshImpostor, { mass: 0, restitution: 0 }, scene);            
        	torus3.physicsImpostor = new BABYLON.PhysicsImpostor(torus3, BABYLON.PhysicsImpostor.MeshImpostor, { mass: 0, restitution: 0 }, scene);          
        	torus4.physicsImpostor = new BABYLON.PhysicsImpostor(torus4, BABYLON.PhysicsImpostor.MeshImpostor, { mass: 0, restitution: 0 }, scene);         
        	domino.physicsImpostor = new BABYLON.PhysicsImpostor(domino, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	domino2.physicsImpostor = new BABYLON.PhysicsImpostor(domino2, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	domino3.physicsImpostor = new BABYLON.PhysicsImpostor(domino3, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	domino4.physicsImpostor = new BABYLON.PhysicsImpostor(domino4, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	domino5.physicsImpostor = new BABYLON.PhysicsImpostor(domino5, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	domino6.physicsImpostor = new BABYLON.PhysicsImpostor(domino6, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	domino7.physicsImpostor = new BABYLON.PhysicsImpostor(domino7, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 1, restitution: 0 }, scene);
        	esfera11.physicsImpostor = new BABYLON.PhysicsImpostor(esfera11, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.8 }, scene);
            esfera12.physicsImpostor = new BABYLON.PhysicsImpostor(esfera12, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.8 }, scene);
            esfera13.physicsImpostor = new BABYLON.PhysicsImpostor(esfera13, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.8 }, scene);
            esfera14.physicsImpostor = new BABYLON.PhysicsImpostor(esfera14, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.8 }, scene);
            esfera15.physicsImpostor = new BABYLON.PhysicsImpostor(esfera15, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.8 }, scene);
            esfera16.physicsImpostor = new BABYLON.PhysicsImpostor(esfera16, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0.8 }, scene);
            esfera17.physicsImpostor = new BABYLON.PhysicsImpostor(esfera17, BABYLON.PhysicsImpostor.SphereImpostor, { mass: 1, restitution: 0 }, scene);
            obstaculo.physicsImpostor = new BABYLON.PhysicsImpostor(obstaculo, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0 }, scene); 
            // gear.physicsImpostor = new BABYLON.PhysicsImpostor(gear, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0 }, scene);  
            // gear2.physicsImpostor = new BABYLON.PhysicsImpostor(gear2, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0 }, scene);   
        
            return scene;
        
        };
                window.initFunction = async function() {               
                    var asyncEngineCreation = async function() {
                        try {
                        return createDefaultEngine();
                        } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                        }
                    }

                    window.engine = await asyncEngineCreation();
        if (!engine) throw 'engine should not be null.';
        window.scene = createScene();};
        initFunction().then(() => {sceneToRender = scene        
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
